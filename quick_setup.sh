#!/bin/bash

# ================================================
# PROTON BOT - –ë–´–°–¢–†–ê–Ø –ù–ê–°–¢–†–û–ô–ö–ê
# ================================================

echo "üöÄ –ë—ã—Å—Ç—Ä–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ Proton Telegram Bot..."
echo ""

# –ü—Ä–æ–≤–µ—Ä–∫–∞ —á—Ç–æ –º—ã –≤ –ø—Ä–∞–≤–∏–ª—å–Ω–æ–π –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏
if [ ! -f "main.py" ]; then
    echo "‚ùå –û—à–∏–±–∫–∞: –∑–∞–ø—É—Å—Ç–∏—Ç–µ —Å–∫—Ä–∏–ø—Ç –∏–∑ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ Proton_bot"
    exit 1
fi

# –°–æ–∑–¥–∞–Ω–∏–µ .env —Ñ–∞–π–ª–∞
echo "üìù –°–æ–∑–¥–∞—é .env —Ñ–∞–π–ª..."
cat > .env << 'EOF'
# Telegram Bot
BOT_TOKEN=7923122647:AAEHvu3KMz2J-9L-nmKH0jKf1TyWGdcdZ7c

# Laravel API
API_URL=https://app.protonrent.ru/api/v1

# Bearer —Ç–æ–∫–µ–Ω
LARAVEL_BEARER_TOKEN=68e21a0a7ce5193998a8289301a59b6e

# Security
NOTIFY_SECRET=proton-telegram-secret-2024
WEBHOOK_SECRET=proton-secret-webhook-2024

# Server
BOT_HOST=0.0.0.0
BOT_PORT=8000
DEBUG=false

# Logging
LOG_LEVEL=INFO
LOG_FILE=bot.log
EOF

echo "‚úÖ .env —Ñ–∞–π–ª —Å–æ–∑–¥–∞–Ω!"
echo ""

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–≥–æ –æ–∫—Ä—É–∂–µ–Ω–∏—è
if [ ! -d ".venv" ]; then
    echo "üì¶ –°–æ–∑–¥–∞—é –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–µ –æ–∫—Ä—É–∂–µ–Ω–∏–µ..."
    python3 -m venv .venv
    echo "‚úÖ –í–∏—Ä—Ç—É–∞–ª—å–Ω–æ–µ –æ–∫—Ä—É–∂–µ–Ω–∏–µ —Å–æ–∑–¥–∞–Ω–æ!"
    echo ""
fi

# –ê–∫—Ç–∏–≤–∞—Ü–∏—è –∏ —É—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
echo "üì• –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞—é –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏..."
source .venv/bin/activate
pip install -r requirements.txt > /dev/null 2>&1
echo "‚úÖ –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã!"
echo ""

echo "‚ú® –ù–ê–°–¢–†–û–ô–ö–ê –ó–ê–í–ï–†–®–ï–ù–ê!"
echo ""
echo "üéØ –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏:"
echo "1. –ï—Å–ª–∏ –Ω—É–∂–Ω–æ, –æ—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä—É–π—Ç–µ .env —Ñ–∞–π–ª"
echo "2. –ó–∞–ø—É—Å—Ç–∏—Ç–µ –±–æ—Ç–∞:"
echo "   ./start_bot.sh"
echo "   –∏–ª–∏"
echo "   python -m uvicorn main:app --host 0.0.0.0 --port 8000"
echo ""
echo "üìä –ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–¥–æ—Ä–æ–≤—å—è:"
echo "   curl http://localhost:8000/health"
echo ""
