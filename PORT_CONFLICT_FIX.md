# Исправление конфликта портов при деплое

## Проблема
При деплое возникала ошибка "address already in use" из-за конфликта порта 8000.

## Решение

### 1. Обновлен workflow файл (.github/workflows/production-release.yml)

**Добавлен новый input параметр:**
- `host_port` - позволяет указать порт хоста вручную (по умолчанию: prod=8000, staging=8080)

**Добавлены переменные окружения:**
- `HOST_PORT` - вычисляется на основе input или дефолтов
- `APP_PORT` - внутренний порт приложения (8000)

**Обновлен шаг деплоя:**
- Добавлено освобождение порта перед запуском контейнера
- Передача переменных HOST_PORT, APP_PORT, IMAGE_TAG в deploy.sh

### 2. Обновлен скрипт deploy.sh

**Новые переменные:**
- `HOST_PORT` - порт хоста (по умолчанию 8000)
- `APP_PORT` - порт приложения (по умолчанию 8000)  
- `IMAGE_TAG` - тег образа (по умолчанию tg-bot:latest)

**Улучшенная логика:**
- Автоматическое освобождение порта HOST_PORT
- Логирование параметров деплоя
- Использование переменных в команде запуска контейнера

## Использование

### Автоматические дефолты:
- **Production**: порт 8000
- **Staging**: порт 8080

### Ручное указание порта:
При запуске workflow можно указать `host_port` для использования другого порта.

### Команда запуска контейнера:
```bash
docker run -d --name "tg-bot" --restart unless-stopped \
  --env-file .env -p "${HOST_PORT}:${APP_PORT}" "$IMAGE_TAG"
```

## Результат
- ✅ Конфликты портов устранены
- ✅ Workflow стал более гибким
- ✅ Автоматическое освобождение портов
- ✅ Логирование параметров деплоя
